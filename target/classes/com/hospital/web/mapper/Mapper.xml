<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hospital.web.mapper.Mapper">
<resultMap id="Patient" type="com.hospital.web.domain.Patient">
	<id property="id" column="pat_id"/>
	<id property="nurID" column="nur_id"/>
	<id property="docID" column="doc_id"/>
	<id property="pass" column="pat_pass"/>
	<id property="name" column="pat_name"/>
	<id property="jumin" column="pat_jumin"/>
	<id property="addr" column="pat_addr"/>
	<id property="phone" column="pat_phone"/>
	<id property="email" column="pat_email"/>
	<id property="job" column="pat_job"/>
	<id property="gen" column="pat_gen"/>
</resultMap>
<resultMap id="Doctor" type="com.hospital.web.domain.Doctor">
	<id property="id" column="doc_id"/>
	<id property="pass" column="doc_pass"/>
	<id property="major" column="majorTreat"/>
	<id property="name" column="doc_name"/>
	<id property="position" column="doc_position"/>
	<id property="phone" column="doc_phone"/>
	<id property="email" column="doc_email"/>
	<id property="gen" column="doc_gen"/>
</resultMap>
<resultMap id="Nurse" type="com.hospital.web.domain.Nurse">
	<id property="id" column="nur_id"/>
	<id property="pass" column="nur_pass"/>
	<id property="major" column="major_job"/>
	<id property="name" column="nur_name"/>
	<id property="position" column="nur_position"/>
	<id property="phone" column="nur_phone"/>
	<id property="email" column="nur_email"/>
	<id property="gen" column="nur_gen"/>
</resultMap>
<insert id="registPatient">
  INSERT INTO ${group}(pat_id, nur_id, doc_id, pat_pass,pat_name,pat_jumin,pat_addr,pat_phone,pat_email,pat_job,pat_gen) 
  VALUES (#{id}, #{nurID},#{docID},#{pass}, #{name},#{jumin},#{addr}, #{phone},#{email},#{job},#{gen})
</insert>
<insert id="registDoctor">
  INSERT INTO ${group}(doc_id,doc_pass,major_treat,doc_name,doc_gen,doc_phone.doc_email,doc_postion)
  VALUES (#{id},#{pass},#{major},#{name},#{gen},#{phone}, #{email},#{postion})
</insert>
<insert id="registNurse">
  INSERT INTO ${group}(nur_id,nur_pass,major_job,nur_name,nur_gen,nur_phone.nur_email,nur_postion) 
  VALUES (#{id},#{pass},#{major},#{name},#{gen},#{phone}, #{email},#{postion})
</insert>
  <select id="findPatient" resultMap="Patient" parameterType="hashMap">
     SELECT * FROM ${group} WHERE ${key} = #{value} 
  </select>
    <select id="findDoctor" resultMap="Doctor" parameterType="hashMap">
     SELECT * FROM ${group} WHERE ${key} = #{value} 
  </select>
   <select id="findNurse" resultMap="Nurse" parameterType="hashMap">
     SELECT * FROM ${group} WHERE ${key} = #{value} 
  </select>
  <select id="findPatients" resultMap="Patient" parameterType="hashMap">
     SELECT * FROM ${group} 
     WHERE
    <if test="docID != null">
    	doc_id like #{doc_id}
  </if>
    <if test="nurID != null">
    	nur_id like #{nur_id}
  </if>
    <if test="name != null">
    	pat_name like #{pat_name}
  </if>
    <if test="gen != null">
    	pat_gen like #{pat_gen}
  </if>
  <if test="addr = null">
    AND pat_addr like #{pat_addr}
    </if>
      <if test="job = null">
    AND pat_job like #{pat_job}
    </if>
  </select>
    <select id="findDoctors" resultMap="Doctor" parameterType="hashMap">
     SELECT * FROM ${group} 
     WHERE
    <if test="${key} != null">
    ${key} = #{value}
  </if>
  </select>
    <select id="findNurses" resultMap="Nurse" parameterType="hashMap">
     SELECT * FROM ${group} 
     WHERE
    <if test="state != null">
    state = #{state}
  </if>
  <if test="title != null">
    AND title like #{title}
  </if>
  <if test="author != null and author.name != null">
    AND author_name like #{author.name}
    </if>
  </select>
  <select id="count" resultType="int">
  SELECT COUNT(*) FROM ${group}
  </select>
   <select id="exist" resultType="int" parameterType="hashMap">
  SELECT COUNT(*) FROM ${group} WHERE ${key}=#{value}
  </select>
  <update id="updatePatient">
  UPDATE Author
    <set>
      <if test="username != null">username=#{username},</if>
      <if test="password != null">password=#{password},</if>
      <if test="email != null">email=#{email},</if>
      <if test="bio != null">bio=#{bio}</if>
    </set>
  WHERE ${key}=#{value}
</update>
  <update id="updateDoctor">
  UPDATE Author
    <set>
      <if test="username != null">username=#{username},</if>
      <if test="password != null">password=#{password},</if>
      <if test="email != null">email=#{email},</if>
      <if test="bio != null">bio=#{bio}</if>
    </set>
  WHERE ${key}=#{value}
</update>
  <update id="updateNurse">
  UPDATE Author
    <set>
      <if test="username != null">username=#{username},</if>
      <if test="password != null">password=#{password},</if>
      <if test="email != null">email=#{email},</if>
      <if test="bio != null">bio=#{bio}</if>
    </set>
  WHERE ${key}=#{value}
</update>


<select id="find" resultType="com.hospital.web.domain.Patient">
 	 SELECT * FROM Patient WHERE pat_id = #{id} 
  <if test="title != null">
    AND title like #{title}
  </if>
</select>
<select id="find2" resultType="com.hospital.web.domain.Patient">
  	 SELECT * FROM Patient WHERE state = ‘ACTIVE’
  <if test="title != null">
    AND title like #{title}
  </if>
  <if test="author != null and author.name != null">
    AND author_name like #{author.name}
  </if>
</select>
<select id="find3" resultType="com.hospital.web.domain.Patient">
     SELECT * FROM Patient WHERE state = ‘ACTIVE’
  <choose>
    <when test="title != null">
      AND title like #{title}
    </when>
    <when test="author != null and author.name != null">
      AND author_name like #{author.name}
    </when>
    <otherwise>
      AND featured = 1
    </otherwise>
  </choose>
</select>
<select id="find4" resultType="com.hospital.web.domain.Patient">
     SELECT * FROM Patient
  WHERE
  <if test="state != null">
    state = #{state}
  </if>
  <if test="title != null">
    AND title like #{title}
  </if>
  <if test="author != null and author.name != null">
    AND author_name like #{author.name}
  </if>
</select>
<select id="find5" resultType="com.hospital.web.domain.Patient">
  SELECT * FROM Patient
  <where>
    <if test="state != null">
         state = #{state}
    </if>
    <if test="title != null">
        AND title like #{title}
    </if>
    <if test="author != null and author.name != null">
        AND author_name like #{author.name}
    </if>
  </where>
</select>

<select id="select" resultType="com.hospital.web.domain.Patient">
  	 SELECT * FROM Patient
  WHERE ID in
  <foreach item="item" index="index" collection="list"
      open="(" separator="," close=")">
        #{item}
  </foreach>
</select>
<select id="select2" resultType="com.hospital.web.domain.Patient">
  <bind name="pattern" value="'%' + _parameter.getTitle() + '%'" />
  	 SELECT * FROM Patient
  WHERE title LIKE #{pattern}
</select>

</mapper>